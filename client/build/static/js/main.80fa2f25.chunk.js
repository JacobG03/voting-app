(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{10:function(e,t,n){e.exports={navbar:"Navbar_navbar__31-FB",content:"Navbar_content__qaagy",signin:"Navbar_signin__3U__V",action:"Navbar_action__678mY"}},11:function(e,t,n){e.exports={form:"LoginForm_form__2a8w7",switch:"LoginForm_switch__3MoTp",submit:"LoginForm_submit__2fOIw"}},16:function(e,t,n){e.exports={App:"App_App__16ZpL",content:"App_content__3La4L"}},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),r=n(17),o=n.n(r),c=(n(22),n(3)),i=n(16),l=n.n(i),u=n(2),j=n.n(u),d=n(6);function b(e){return p.apply(this,arguments)}function p(){return(p=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"GET",mode:"cors",credentials:"same-origin"}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return h.apply(this,arguments)}function h(){return h=Object(d.a)(j.a.mark((function e(t){var n,s,a=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,fetch(t,{method:"POST",mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json().then((function(t){return{status:e.status,body:t}}))}));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}var m=n(5),f=n(7),_=n(8),v=n.n(_),x=n(14),g=n(0);function y(e){var t=Object(x.a)(),n=t.register,s=t.handleSubmit,a=t.unregister;return Object(g.jsxs)("form",{className:v.a.form,onSubmit:s((function(t){var n={topic:t.topic,options:[]};for(var s in t)"topic"!==s&&n.options.push(t[s]);O("/polls",n).then((function(t){200===t.status?(e.rerenderPolls((function(e){return!e})),e.displayPoll(!1)):console.log(t.body)}))})),children:[Object(g.jsxs)("div",{className:v.a.fields,children:[Object(g.jsx)("span",{children:"Topic:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Topic"},n("topic",{required:!0})))]}),Object(g.jsx)(N,{unregister:a,register:n}),Object(g.jsxs)("div",{className:v.a.finish,children:[Object(g.jsx)("span",{onClick:function(){return e.displayPoll((function(e){return!e}))},children:"Cancel"}),Object(g.jsx)("input",{type:"submit",className:v.a.submit,value:"Create Poll"})]})]})}function N(e){var t=Object(s.useState)([]),n=Object(c.a)(t,2),a=n[0],r=n[1];return Object(g.jsxs)("div",{className:v.a.options,children:[a.map((function(t){return Object(g.jsx)(P,{unregister:e.unregister,options:a,setOptions:r,option:t,register:e.register},t.id)})),Object(g.jsx)("button",{className:v.a.addBtn,onClick:function(){r((function(e){return[].concat(Object(m.a)(e),[{id:a.length}])}))},children:"Add Option"})]})}function P(e){return Object(g.jsxs)("div",{className:v.a.option,children:[Object(g.jsx)("input",Object(f.a)({placeholder:"Option ".concat(e.option.id)},e.register("option-".concat(e.option.id),{required:!0}))),Object(g.jsx)("button",{className:v.a.delBtn,onClick:function(){return function(){var t=e.options.filter((function(t){return t!==e.option}));e.unregister("option-".concat(e.option.id)),e.setOptions(t)}()},children:"-"})]})}var S=function(e){return Object(g.jsxs)("div",{className:v.a.main,children:[Object(g.jsxs)("div",{className:v.a.top,children:[Object(g.jsx)("img",{src:e.user.avatar,alt:"User"}),Object(g.jsx)("span",{children:e.user.username})]}),Object(g.jsx)(y,{rerenderPolls:e.rerenderPolls,displayPoll:e.displayPoll})]})},C=n(4),w=n.n(C);function L(e){var t=e.data,n=Object(s.useState)(t.votes),a=Object(c.a)(n,2),r=a[0],o=a[1];return Object(g.jsxs)("div",{className:w.a.poll,children:[Object(g.jsx)(A,{url:t.author_url}),Object(g.jsx)("span",{className:w.a.timestamp,children:t.timestamp}),Object(g.jsx)("div",{className:w.a.topic,children:Object(g.jsx)("span",{children:t.topic})}),Object(g.jsx)(F,{url:t.options_url,user:e.user,setVotesNum:o}),Object(g.jsx)("span",{className:w.a.poll_votes,children:r})]})}function F(e){var t=Object(s.useState)(null),n=Object(c.a)(t,2),a=n[0],r=n[1];Object(s.useEffect)((function(){b(e.url).then((function(e){return r(e.body)}))}),[e.url]);var o=Object(s.useCallback)((function(){b(e.url).then((function(t){r(null),r(t.body),e.setVotesNum((function(e){return e+1}))}))}),[e]);return a?Object(g.jsx)("div",{className:w.a.options,children:a.map((function(t){return Object(g.jsx)(q,{data:t,reqPoll:o,user:e.user},t.index)}))}):null}function q(e){var t=Object(s.useState)(null),n=Object(c.a)(t,2),a=n[0],r=n[1],o=Object(s.useState)(!1),i=Object(c.a)(o,2),l=i[0],u=i[1],j=e.data;return Object(s.useEffect)((function(){e.user&&b(j.votes_url).then((function(e){202===e.status?r(!0):200===e.status&&(r(e.body.votes),u(e.body.voted))}))}),[e.user,j.votes_url]),null===a?Object(g.jsx)("div",{className:w.a.option,children:Object(g.jsx)("span",{children:j.body})}):!0===a?Object(g.jsx)(U,{data:j,reqPoll:e.reqPoll}):Object(g.jsx)(k,{data:j,votes:a,voted:l})}function k(e){var t=Object(s.useState)(!1),n=Object(c.a)(t,2),a=n[0],r=n[1],o=e.data;return a?Object(g.jsxs)("div",{className:"".concat(w.a.option," ").concat(e.voted?w.a.voted:null),onClick:function(){return r(!a)},children:[Object(g.jsx)("div",{className:w.a.option_avatars,children:e.votes.length>0?e.votes.map((function(e){return Object(g.jsx)("img",{src:e.avatar,alt:"user"},e.username)})):Object(g.jsx)("span",{children:"No votes"})}),Object(g.jsx)("div",{className:w.a.option_votes,children:e.votes.length})]}):Object(g.jsxs)("div",{className:"".concat(w.a.option," ").concat(e.voted?w.a.voted:null),onClick:function(){return r(!a)},children:[Object(g.jsx)("div",{className:w.a.option_body,children:Object(g.jsx)("span",{children:o.body})}),Object(g.jsx)("div",{className:w.a.option_votes,children:e.votes.length})]})}function U(e){var t=e.data,n={anonymous:!1};return Object(g.jsx)("div",{className:"".concat(w.a.option," ").concat(w.a.vote),onClick:function(){return O(t.votes_url,n).then((function(e){return console.log(e.body.msg)})),void e.reqPoll()},children:Object(g.jsx)("span",{children:t.body})})}function A(e){var t=Object(s.useState)(null),n=Object(c.a)(t,2),a=n[0],r=n[1];return Object(s.useEffect)((function(){b(e.url).then((function(e){200===e.status&&r(e.body)}))}),[e.url]),a?Object(g.jsxs)("div",{className:w.a.author,children:[Object(g.jsx)("img",{src:a.avatar,alt:"Avatar"}),Object(g.jsx)("span",{children:a.username})]}):null}var B=function(e){var t=Object(s.useState)(null),n=Object(c.a)(t,2),a=n[0],r=n[1];return Object(s.useEffect)((function(){b("/polls").then((function(e){200===e.status&&r(e.body)}))}),[e.user,e.rpolls]),a?Object(g.jsx)("div",{className:w.a.polls,children:a.map((function(t){return Object(g.jsx)(L,{data:t,user:e.user},t.id)}))}):null},T=n(11),E=n.n(T);function G(e){var t=Object(x.a)(),n=t.register,s=t.handleSubmit,a=t.formState.errors;return Object(g.jsxs)("form",{className:E.a.form,onSubmit:s((function(t){O("/login",t).then((function(t){200===t.status&&b("/user").then((function(t){200===t.status&&(e.setUser(t.body),e.displayForm(!1))}))}))})),children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("span",{children:"Login:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Login"},n("email",{required:!0}))),a.email&&Object(g.jsx)("span",{children:"This field is required"}),Object(g.jsx)("span",{children:"Password:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Password",type:"password"},n("password",{required:!0}))),a.password&&Object(g.jsx)("span",{children:"This field is required"})]}),Object(g.jsx)("input",{type:"submit",className:E.a.submit,value:"Sign In"}),Object(g.jsx)("span",{className:E.a.switch,onClick:function(){return e.changeForm((function(e){return!e}))},children:"Register"})]})}function I(e){var t=Object(x.a)(),n=t.register,s=t.handleSubmit,a=t.formState.errors;return Object(g.jsxs)("form",{className:E.a.form,onSubmit:s((function(t){O("/register",t).then((function(t){200===t.status?(console.log(t.body),e.changeForm((function(e){return!e}))):console.log(t.body)}))})),children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("span",{children:"Username:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Username"},n("username",{required:!0,minLength:3,maxLength:64}))),Object(g.jsx)("span",{children:"Login:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Email or just a string"},n("email",{required:!0,minLength:1,maxLength:128}))),Object(g.jsx)("span",{children:"Password:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Password",type:"password"},n("password",{required:!0,minLength:3,maxLength:256}))),a.password&&Object(g.jsx)("span",{children:"This field is required"}),Object(g.jsx)("span",{children:"Repeat Password:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"Repeat Password",type:"password"},n("password2",{required:!0,minLength:3,maxLength:256}))),Object(g.jsx)("span",{children:"Avatar:"}),Object(g.jsx)("input",Object(f.a)({placeholder:"URL: [PNG, JPG, GIF]"},n("avatar",{required:!0})))]}),Object(g.jsx)("input",{type:"submit",className:E.a.submit,value:"Sign Up"}),Object(g.jsx)("span",{className:E.a.switch,onClick:function(){return e.changeForm((function(e){return!e}))},children:"Login"})]})}var R=function(e){var t=Object(s.useState)(!1),n=Object(c.a)(t,2),a=n[0],r=n[1];return a?Object(g.jsx)(I,{changeForm:r}):Object(g.jsx)(G,{setUser:e.setUser,displayForm:e.displayForm,changeForm:r})},V=n(10),J=n.n(V);var M=function(e){var t=Object(s.useCallback)((function(){b("/logout").then((function(t){200===t.status&&e.setUser(!1)}))}),[e]);return e.user?Object(g.jsx)("nav",{className:J.a.navbar,children:Object(g.jsxs)("div",{className:J.a.content,children:[Object(g.jsx)("span",{children:"<Voting App>"}),Object(g.jsxs)("div",{className:J.a.action,children:[e.user?Object(g.jsx)("button",{className:J.a.signin,onClick:function(){return e.displayPoll((function(e){return!e}))},children:"Create Poll"}):null,Object(g.jsx)("button",{className:J.a.signin,onClick:function(){return t()},children:"Sign out"})]})]})}):Object(g.jsx)("nav",{className:J.a.navbar,children:Object(g.jsxs)("div",{className:J.a.content,children:[Object(g.jsx)("span",{children:"<Voting App>"}),Object(g.jsx)("button",{className:J.a.signin,onClick:function(){return e.displayForm((function(e){return!e}))},children:"Sign in"})]})})};var Y=function(){var e=Object(s.useState)(null),t=Object(c.a)(e,2),n=t[0],a=t[1],r=Object(s.useState)(!1),o=Object(c.a)(r,2),i=o[0],u=o[1],j=Object(s.useState)(!1),d=Object(c.a)(j,2),p=d[0],O=d[1],h=Object(s.useState)(!1),m=Object(c.a)(h,2),f=m[0],_=m[1];return Object(s.useEffect)((function(){b("/user").then((function(e){200===e.status?a(e.body):console.log("User is anonymous")}))}),[]),Object(g.jsxs)("div",{className:l.a.App,children:[Object(g.jsx)(M,{user:n,setUser:a,displayForm:u,displayPoll:O}),Object(g.jsxs)("div",{className:l.a.content,children:[i?Object(g.jsx)(R,{setUser:a,displayForm:u}):null,n&&p?Object(g.jsx)(S,{user:n,rerenderPolls:_,displayPoll:O}):null,Object(g.jsx)(B,{user:n,rpolls:f})]})]})};o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(Y,{})}),document.getElementById("root"))},4:function(e,t,n){e.exports={polls:"Polls_polls__1lS4d",poll:"Polls_poll__1aHj7",author:"Polls_author__2Y645",topic:"Polls_topic__S9NdO",timestamp:"Polls_timestamp__36Hh_",options:"Polls_options__mDcop",option:"Polls_option__1xedI",vote:"Polls_vote__XIMus",voted:"Polls_voted__3OnM-",poll_votes:"Polls_poll_votes__KqdhZ",option_body:"Polls_option_body__1bFLU",option_votes:"Polls_option_votes__3tslH",option_avatars:"Polls_option_avatars__3ncQa"}},8:function(e,t,n){e.exports={main:"CreatePoll_main__21y3u",top:"CreatePoll_top__BaGLz",form:"CreatePoll_form__2aajv",fields:"CreatePoll_fields__1_FGR",finish:"CreatePoll_finish__125dg",submit:"CreatePoll_submit__Ujss4",options:"CreatePoll_options__rYrbt",option:"CreatePoll_option__3RxLF",addBtn:"CreatePoll_addBtn__215TB",delBtn:"CreatePoll_delBtn__Pb3Ye"}}},[[25,1,2]]]);
//# sourceMappingURL=main.80fa2f25.chunk.js.map